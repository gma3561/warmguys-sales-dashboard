(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[913],{4966:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/apgujeong",function(){return a(793)}])},4122:function(e,t,a){"use strict";a.d(t,{Z:function(){return Navigation}});var s=a(5893);a(7294);var r=a(1664),l=a.n(r),n=a(1163);function Navigation(){let e=(0,n.useRouter)();return(0,s.jsx)("nav",{className:"bg-blue-600 text-white p-4",children:(0,s.jsxs)("div",{className:"container mx-auto flex justify-between items-center",children:[(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsx)(l(),{href:"/",children:(0,s.jsx)("span",{className:"text-xl font-bold cursor-pointer",children:"계열사 매출 대시보드"})})}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)(l(),{href:"/",children:(0,s.jsx)("span",{className:"cursor-pointer px-3 py-2 rounded ".concat("/"===e.pathname?"bg-blue-700":"hover:bg-blue-700"),children:"대시보드"})}),(0,s.jsx)(l(),{href:"/admin",children:(0,s.jsx)("span",{className:"cursor-pointer px-3 py-2 rounded ".concat("/admin"===e.pathname?"bg-blue-700":"hover:bg-blue-700"),children:"관리자"})})]})]})})}},3946:function(e,t,a){"use strict";a.d(t,{$7:function(){return getAffiliateConfig},OQ:function(){return r},Qt:function(){return calculateKPIs},fD:function(){return getSalesData}});var s=a(8590);let r=(0,s.eI)("https://ooqexropurnslqmcbjqk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9vcWV4cm9wdXJuc2xxbWNianFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc0NzQyMDUsImV4cCI6MjA2MzA1MDIwNX0.yXVabtxZwX3QFF6xnjmj5VI2Lrp_7fZ3HvS5dCalbuA"),l={ALL:null,MRS:"mrs_sales",WARMGUYS:"warmguys_sales",APGUJEONG:"apgujeong_apgujung_sales",GAROSU:"garosu_sales",GEUKJIN:"geukjin_sales"};async function getSalesData(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"MRS",a=new Date,s=new Date;if(s.setDate(a.getDate()-e),"ALL"===t){let{data:e,error:t}=await r.from("all_affiliates_view").select("*").gte("date",s.toISOString().split("T")[0]).order("date",{ascending:!0});return t?(console.error("Error fetching all affiliates data:",t),[]):e}{let e=l[t];if(!e)return console.error("Invalid affiliate key:",t),[];let{data:a,error:n}=await r.from(e).select("*").gte("date",s.toISOString().split("T")[0]).order("date",{ascending:!0});return n?(console.error("Error fetching ".concat(e," data:"),n),[]):a}}async function getAffiliateConfig(){let{data:e,error:t}=await r.from("affiliate_config").select("*").eq("is_active",!0).order("affiliate_name");return t?(console.error("Error fetching affiliate config:",t),[]):e}function calculateKPIs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"MRS";if(!e||0===e.length)return{totalSales:0,averageDailySales:0,totalOrders:0,refundRate:0,growthRate:0};let a=e.reduce((e,t)=>e+(parseFloat(t.total_sales)||0),0),s=a/e.length,r=e.reduce((e,a)=>"APGUJEONG"===t?e+(parseInt(a.customer_count)||0):e+(parseInt(a.order_count)||0),0),l=e.reduce((e,a)=>"GEUKJIN"===t?0:e+(parseFloat(a.refund_amount)||0),0),n=0;if(e.length>=2){let t=e[e.length-1],a=e[e.length-2],s=parseFloat(t.total_sales)||0,r=parseFloat(a.total_sales)||0;r>0&&(n=(s-r)/r*100)}return{totalSales:a,averageDailySales:s,totalOrders:r,refundRate:a>0?l/a*100:0,growthRate:n}}},3850:function(e,t,a){"use strict";function formatNumber(e){return null==e?"0":new Intl.NumberFormat("ko-KR").format(Math.round(e))}function formatPercent(e){return null==e?"0%":"".concat(e.toFixed(1),"%")}a.d(t,{T3:function(){return formatPercent},uf:function(){return formatNumber}})},793:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return v}});var s=a(5893),r=a(7294),l=a(9008),n=a.n(l),c=a(1163),i=a(3706),o=a(3946),d=a(4122),u=a(3850),x=a(9009),h=a(8687),m=a(4195),p=a(3023),g=a(5358),f=a(6050),j=a(3558),b=a(6880),_=a(4831),y=a(483),components_ApgujeongDashboard=e=>{let{salesData:t,kpis:a}=e,[l]=(0,r.useState)([{value:"all",label:"전체 지점"},{value:"apgujeong",label:"압구정점"},{value:"garosu",label:"가로수점"}]),[n,c]=(0,r.useState)([]);(0,r.useEffect)(()=>{if(!t||0===t.length)return;let e=t.map(e=>({date:e.date,cardSales:parseFloat(e.card_sales||0),cashSales:parseFloat(e.cash_sales||0),cashReceipt:parseFloat(e.cash_receipt||0),deliverySales:parseFloat(e.delivery_sales||0),accountTransfer:parseFloat(e.account_transfer||0),totalSales:parseFloat(e.total_sales||0),customerCount:parseInt(e.customer_count||0),tableTurnover:parseFloat(e.table_turnover||0)}));c(e)},[t]);let i=n.slice(-30),o=n.reduce((e,t)=>e+t.cardSales,0),d=n.reduce((e,t)=>e+t.cashSales+t.cashReceipt,0),v=n.reduce((e,t)=>e+t.deliverySales,0),N=n.reduce((e,t)=>e+t.accountTransfer,0),w=[{name:"카드",value:o},{name:"현금",value:d},{name:"배달",value:v},{name:"계좌이체",value:N}],S=n.slice(-14);return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"총매출"}),(0,s.jsxs)("p",{className:"text-2xl font-bold",children:[(0,u.uf)(a.totalSales||0),"원"]}),(0,s.jsxs)("p",{className:"text-sm ".concat(a.growthRate>=0?"text-green-500":"text-red-500"),children:[a.growthRate>=0?"↑":"↓"," ",Math.abs(a.growthRate||0).toFixed(1),"%"]})]}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"카드 매출"}),(0,s.jsxs)("p",{className:"text-2xl font-bold",children:[(0,u.uf)(o),"원"]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["전체의 ",(0,u.T3)(o/a.totalSales*100||0)]})]}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"총 고객수"}),(0,s.jsxs)("p",{className:"text-2xl font-bold",children:[(0,u.uf)(n.reduce((e,t)=>e+t.customerCount,0)),"명"]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["객단가 ",(0,u.uf)(a.totalSales/n.reduce((e,t)=>e+t.customerCount,0)),"원"]})]}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"평균 테이블 회전율"}),(0,s.jsxs)("p",{className:"text-2xl font-bold",children:[(n.reduce((e,t)=>e+t.tableTurnover,0)/n.length||0).toFixed(1),"회"]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["최고 ",Math.max(...n.map(e=>e.tableTurnover||0)).toFixed(1),"회"]})]})]}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow overflow-x-auto",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-3",children:"일별 매출 상세"}),(0,s.jsxs)("table",{className:"min-w-full divide-y divide-gray-200",children:[(0,s.jsx)("thead",{children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"날짜"}),(0,s.jsx)("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"카드"}),(0,s.jsx)("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"현금"}),(0,s.jsx)("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"현금영수증"}),(0,s.jsx)("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"배달"}),(0,s.jsx)("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"계좌이체"}),(0,s.jsx)("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"고객수"}),(0,s.jsx)("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"테이블회전율"}),(0,s.jsx)("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"총매출"})]})}),(0,s.jsx)("tbody",{className:"bg-white divide-y divide-gray-200",children:n.slice().reverse().map((e,t)=>(0,s.jsxs)("tr",{className:t%2==0?"bg-gray-50":"bg-white",children:[(0,s.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm",children:e.date}),(0,s.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-right",children:(0,u.uf)(e.cardSales)}),(0,s.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-right",children:(0,u.uf)(e.cashSales)}),(0,s.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-right",children:(0,u.uf)(e.cashReceipt)}),(0,s.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-right",children:(0,u.uf)(e.deliverySales)}),(0,s.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-right",children:(0,u.uf)(e.accountTransfer)}),(0,s.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-right",children:e.customerCount}),(0,s.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-right",children:e.tableTurnover.toFixed(1)}),(0,s.jsx)("td",{className:"px-4 py-2 whitespace-nowrap text-sm text-right font-bold",children:(0,u.uf)(e.totalSales)})]},t))})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-3",children:"총매출 추이"}),(0,s.jsx)("div",{className:"h-64",children:(0,s.jsx)(x.h,{width:"100%",height:"100%",children:(0,s.jsxs)(h.w,{data:i,margin:{top:5,right:30,left:20,bottom:5},children:[(0,s.jsx)(m.q,{strokeDasharray:"3 3"}),(0,s.jsx)(p.K,{dataKey:"date"}),(0,s.jsx)(g.B,{}),(0,s.jsx)(f.u,{formatter:e=>["".concat((0,u.uf)(e),"원"),"매출"],labelFormatter:e=>"날짜: ".concat(e)}),(0,s.jsx)(j.D,{}),(0,s.jsx)(b.x,{type:"monotone",dataKey:"totalSales",name:"총매출",stroke:"#8884d8",activeDot:{r:8}})]})})})]}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-3",children:"결제 방식 분포"}),(0,s.jsx)("div",{className:"h-64",children:(0,s.jsx)(x.h,{width:"100%",height:"100%",children:(0,s.jsxs)(_.v,{data:w,margin:{top:5,right:30,left:20,bottom:5},children:[(0,s.jsx)(m.q,{strokeDasharray:"3 3"}),(0,s.jsx)(p.K,{dataKey:"name"}),(0,s.jsx)(g.B,{}),(0,s.jsx)(f.u,{formatter:e=>["".concat((0,u.uf)(e),"원"),"매출"]}),(0,s.jsx)(j.D,{}),(0,s.jsx)(y.$,{dataKey:"value",name:"매출액",fill:"#82ca9d"})]})})})]}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-3",children:"고객수 & 테이블 회전율 추이"}),(0,s.jsx)("div",{className:"h-64",children:(0,s.jsx)(x.h,{width:"100%",height:"100%",children:(0,s.jsxs)(h.w,{data:S,margin:{top:5,right:30,left:20,bottom:5},children:[(0,s.jsx)(m.q,{strokeDasharray:"3 3"}),(0,s.jsx)(p.K,{dataKey:"date"}),(0,s.jsx)(g.B,{yAxisId:"left"}),(0,s.jsx)(g.B,{yAxisId:"right",orientation:"right"}),(0,s.jsx)(f.u,{}),(0,s.jsx)(j.D,{}),(0,s.jsx)(b.x,{yAxisId:"left",type:"monotone",dataKey:"customerCount",name:"고객수",stroke:"#8884d8"}),(0,s.jsx)(b.x,{yAxisId:"right",type:"monotone",dataKey:"tableTurnover",name:"테이블회전율",stroke:"#82ca9d"})]})})})]}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-3",children:"결제 방식별 일간 추이"}),(0,s.jsx)("div",{className:"h-64",children:(0,s.jsx)(x.h,{width:"100%",height:"100%",children:(0,s.jsxs)(h.w,{data:i,margin:{top:5,right:30,left:20,bottom:5},children:[(0,s.jsx)(m.q,{strokeDasharray:"3 3"}),(0,s.jsx)(p.K,{dataKey:"date"}),(0,s.jsx)(g.B,{}),(0,s.jsx)(f.u,{formatter:e=>["".concat((0,u.uf)(e),"원"),"매출"]}),(0,s.jsx)(j.D,{}),(0,s.jsx)(b.x,{type:"monotone",dataKey:"cardSales",name:"카드",stroke:"#8884d8"}),(0,s.jsx)(b.x,{type:"monotone",dataKey:"cashSales",name:"현금",stroke:"#82ca9d"}),(0,s.jsx)(b.x,{type:"monotone",dataKey:"deliverySales",name:"배달",stroke:"#ffc658"})]})})})]})]})]})},v=(0,i.QO)(function(){let[e,t]=(0,r.useState)(!0),[a,l]=(0,r.useState)([]),[i,u]=(0,r.useState)([]),[x,h]=(0,r.useState)([]),[m,p]=(0,r.useState)([]),[g,f]=(0,r.useState)("all"),[j,b]=(0,r.useState)({}),[_,y]=(0,r.useState)(30);(0,c.useRouter)(),(0,r.useEffect)(()=>{(async function(){t(!0);try{let e;let t=await (0,o.fD)(_,"APGUJEONG");u(t);let a=await (0,o.fD)(_,"GAROSU");if(h(a),"apgujeong"===g)e=t,l(t);else if("garosu"===g)e=a,l(a);else{let s=combineStoreData(t,a);p(s),e=s,l(s)}let s=(0,o.Qt)(e,"APGUJEONG");b(s)}catch(e){console.error("Error fetching store data:",e)}finally{t(!1)}})()},[_,g]);let handlePeriodChange=e=>{y(e)},handleBranchChange=e=>{f(e)},combineStoreData=(e,t)=>{let a={};e.forEach(e=>{a[e.date]||(a[e.date]={date:e.date,card_sales:0,cash_sales:0,cash_receipt:0,delivery_sales:0,account_transfer:0,total_sales:0,customer_count:0,table_turnover:0}),a[e.date].card_sales+=parseFloat(e.card_sales||0),a[e.date].cash_sales+=parseFloat(e.cash_sales||0),a[e.date].cash_receipt+=parseFloat(e.cash_receipt||0),a[e.date].delivery_sales+=parseFloat(e.delivery_sales||0),a[e.date].account_transfer+=parseFloat(e.account_transfer||0),a[e.date].total_sales+=parseFloat(e.total_sales||0),a[e.date].customer_count+=parseInt(e.customer_count||0),a[e.date].table_turnover_sum=(a[e.date].table_turnover_sum||0)+parseFloat(e.table_turnover||0),a[e.date].table_turnover_count=(a[e.date].table_turnover_count||0)+1}),t.forEach(e=>{a[e.date]||(a[e.date]={date:e.date,card_sales:0,cash_sales:0,cash_receipt:0,delivery_sales:0,account_transfer:0,total_sales:0,customer_count:0,table_turnover:0,table_turnover_sum:0,table_turnover_count:0}),a[e.date].card_sales+=parseFloat(e.card_sales||0),a[e.date].cash_sales+=parseFloat(e.cash_sales||0),a[e.date].cash_receipt+=parseFloat(e.cash_receipt||0),a[e.date].delivery_sales+=parseFloat(e.delivery_sales||0),a[e.date].account_transfer+=parseFloat(e.account_transfer||0),a[e.date].total_sales+=parseFloat(e.total_sales||0),a[e.date].customer_count+=parseInt(e.customer_count||0),a[e.date].table_turnover_sum=(a[e.date].table_turnover_sum||0)+parseFloat(e.table_turnover||0),a[e.date].table_turnover_count=(a[e.date].table_turnover_count||0)+1});let s=Object.values(a).map(e=>(e.table_turnover=e.table_turnover_count>0?e.table_turnover_sum/e.table_turnover_count:0,delete e.table_turnover_sum,delete e.table_turnover_count,e));return s.sort((e,t)=>new Date(e.date)-new Date(t.date))};return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,s.jsxs)(n(),{children:[(0,s.jsx)("title",{children:"웜가이즈 - 압구정곱창 대시보드"}),(0,s.jsx)("meta",{name:"description",content:"웜가이즈 압구정곱창 매출 대시보드"})]}),(0,s.jsx)(d.Z,{}),(0,s.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold",children:"압구정곱창 대시보드"}),(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{onClick:()=>handleBranchChange("all"),className:"px-4 py-2 rounded ".concat("all"===g?"bg-blue-500 text-white":"bg-gray-200"),children:"전체 지점"}),(0,s.jsx)("button",{onClick:()=>handleBranchChange("apgujeong"),className:"px-4 py-2 rounded ".concat("apgujeong"===g?"bg-blue-500 text-white":"bg-gray-200"),children:"압구정점"}),(0,s.jsx)("button",{onClick:()=>handleBranchChange("garosu"),className:"px-4 py-2 rounded ".concat("garosu"===g?"bg-blue-500 text-white":"bg-gray-200"),children:"가로수점"})]})]}),(0,s.jsx)("div",{className:"flex justify-end mb-4",children:(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{onClick:()=>handlePeriodChange(7),className:"px-4 py-2 rounded ".concat(7===_?"bg-blue-500 text-white":"bg-gray-200"),children:"7일"}),(0,s.jsx)("button",{onClick:()=>handlePeriodChange(30),className:"px-4 py-2 rounded ".concat(30===_?"bg-blue-500 text-white":"bg-gray-200"),children:"30일"}),(0,s.jsx)("button",{onClick:()=>handlePeriodChange(90),className:"px-4 py-2 rounded ".concat(90===_?"bg-blue-500 text-white":"bg-gray-200"),children:"90일"})]})}),e?(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):(0,s.jsx)(components_ApgujeongDashboard,{salesData:a,kpis:j})]})]})})}},function(e){e.O(0,[227,664,394,774,888,179],function(){return e(e.s=4966)}),_N_E=e.O()}]);