(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{4730:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return i(9540)}])},3946:function(e,t,i){"use strict";i.d(t,{$7:function(){return getAffiliateConfig},OQ:function(){return n},Qt:function(){return calculateKPIs},fD:function(){return getSalesData}});var a=i(8590);let n=(0,a.eI)("https://ooqexropurnslqmcbjqk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9vcWV4cm9wdXJuc2xxbWNianFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc0NzQyMDUsImV4cCI6MjA2MzA1MDIwNX0.yXVabtxZwX3QFF6xnjmj5VI2Lrp_7fZ3HvS5dCalbuA"),r={ALL:null,MRS:"mrs_sales",WARMGUYS:"warmguys_sales",APGUJEONG:"apgujeong_apgujung_sales",GAROSU:"garosu_sales",GEUKJIN:"geukjin_sales"};async function getSalesData(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"MRS",i=new Date,a=new Date;if(a.setDate(i.getDate()-e),"ALL"===t){let{data:e,error:t}=await n.from("all_affiliates_view").select("*").gte("date",a.toISOString().split("T")[0]).order("date",{ascending:!0});return t?(console.error("Error fetching all affiliates data:",t),[]):e}{let e=r[t];if(!e)return console.error("Invalid affiliate key:",t),[];let{data:i,error:s}=await n.from(e).select("*").gte("date",a.toISOString().split("T")[0]).order("date",{ascending:!0});return s?(console.error("Error fetching ".concat(e," data:"),s),[]):i}}async function getAffiliateConfig(){let{data:e,error:t}=await n.from("affiliate_config").select("*").eq("is_active",!0).order("affiliate_name");return t?(console.error("Error fetching affiliate config:",t),[]):e}function calculateKPIs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"MRS";if(!e||0===e.length)return{totalSales:0,averageDailySales:0,totalOrders:0,refundRate:0,growthRate:0};let i=e.reduce((e,t)=>e+(parseFloat(t.total_sales)||0),0),a=i/e.length,n=e.reduce((e,i)=>"APGUJEONG"===t?e+(parseInt(i.customer_count)||0):e+(parseInt(i.order_count)||0),0),r=e.reduce((e,i)=>"GEUKJIN"===t?0:e+(parseFloat(i.refund_amount)||0),0),s=0;if(e.length>=2){let t=e[e.length-1],i=e[e.length-2],a=parseFloat(t.total_sales)||0,n=parseFloat(i.total_sales)||0;n>0&&(s=(a-n)/n*100)}return{totalSales:i,averageDailySales:a,totalOrders:n,refundRate:i>0?r/i*100:0,growthRate:s}}},9540:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return Admin}});var a=i(5893),n=i(7294),r=i(9008),s=i.n(r),l=i(3946),c=i(520),o=i(1298),d=i(4940),f=i(8978),u=i(7184),h=i(3749),g=i(3384),_=i(1675),x=i(4234);i(7641);var j=i(9970);function Admin(){let[e,t]=(0,n.useState)([]),[i,r]=(0,n.useState)(!0),[m,p]=(0,n.useState)({});(0,n.useEffect)(()=>{!async function(){r(!0);let e=await (0,l.$7)();t(e),r(!1)}()},[]);let initiateSync=async e=>{p(t=>({...t,[e]:"pending"}));try{let t=await fetch("https://ooqexropurnslqmcbjqk.functions.supabase.co/data-sync",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat("eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9vcWV4cm9wdXJuc2xxbWNianFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc0NzQyMDUsImV4cCI6MjA2MzA1MDIwNX0.yXVabtxZwX3QFF6xnjmj5VI2Lrp_7fZ3HvS5dCalbuA")},body:JSON.stringify({affiliate_key:e})}),i=await t.json();i.success?p(t=>({...t,[e]:"success"})):p(t=>({...t,[e]:"error"}))}catch(t){console.error("동기화 요청 에러:",t),p(t=>({...t,[e]:"error"}))}setTimeout(()=>{p(t=>{let i={...t};return delete i[e],i})},5e3)},toggleAffiliateActive=async(e,i)=>{try{let{error:a}=await l.OQ.from("affiliate_config").update({is_active:!i}).eq("affiliate_key",e);if(a)throw a;t(t=>t.map(t=>t.affiliate_key===e?{...t,is_active:!i}:t))}catch(e){console.error("계열사 상태 변경 에러:",e)}},getBadgeColor=e=>{switch(e){case"success":return"green";case"pending":return"yellow";case"error":return"red";default:return"gray"}};return(0,a.jsxs)("div",{children:[(0,a.jsxs)(s(),{children:[(0,a.jsx)("title",{children:"관리자 - 계열사 매출 대시보드"}),(0,a.jsx)("meta",{name:"description",content:"계열사 매출 데이터 관리"}),(0,a.jsx)("link",{rel:"icon",href:"/favicon.ico"})]}),(0,a.jsxs)("main",{className:"p-6",children:[(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"계열사 관리"}),(0,a.jsx)("p",{className:"text-gray-500",children:"데이터 동기화 및 계열사 설정"})]}),i?(0,a.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,a.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):(0,a.jsxs)(d.Z,{children:[(0,a.jsx)(j.Z,{children:"계열사 설정"}),(0,a.jsxs)(f.Z,{className:"mt-4",children:[(0,a.jsx)(g.Z,{children:(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(_.Z,{children:"계열사 ID"}),(0,a.jsx)(_.Z,{children:"계열사명"}),(0,a.jsx)(_.Z,{children:"스프레드시트"}),(0,a.jsx)(_.Z,{children:"마지막 동기화"}),(0,a.jsx)(_.Z,{children:"상태"}),(0,a.jsx)(_.Z,{children:"동기화"}),(0,a.jsx)(_.Z,{children:"활성화"})]})}),(0,a.jsx)(u.Z,{children:e.map(e=>(0,a.jsxs)(x.Z,{children:[(0,a.jsx)(h.Z,{children:e.affiliate_key}),(0,a.jsx)(h.Z,{children:e.affiliate_name}),(0,a.jsx)(h.Z,{children:(0,a.jsx)("a",{href:"https://docs.google.com/spreadsheets/d/".concat(e.spreadsheet_id),target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:e.sheet_name})}),(0,a.jsx)(h.Z,{children:e.last_successful_sync?new Date(e.last_successful_sync).toLocaleString("ko-KR"):"없음"}),(0,a.jsx)(h.Z,{children:m[e.affiliate_key]?(0,a.jsx)(c.Z,{color:getBadgeColor(m[e.affiliate_key]),children:"success"===m[e.affiliate_key]?"성공":"pending"===m[e.affiliate_key]?"진행 중":"오류"}):(0,a.jsx)(c.Z,{color:e.sync_enabled?"green":"gray",children:e.sync_enabled?"동기화 활성화":"동기화 비활성화"})}),(0,a.jsx)(h.Z,{children:(0,a.jsx)(o.Z,{size:"xs",color:"blue",onClick:()=>initiateSync(e.affiliate_key),disabled:"pending"===m[e.affiliate_key]||!e.sync_enabled,children:"지금 동기화"})}),(0,a.jsx)(h.Z,{children:(0,a.jsx)(o.Z,{size:"xs",color:e.is_active?"green":"red",onClick:()=>toggleAffiliateActive(e.affiliate_key,e.is_active),children:e.is_active?"활성화됨":"비활성화됨"})})]},e.id))})]})]})]})]})}}},function(e){e.O(0,[227,765,774,888,179],function(){return e(e.s=4730)}),_N_E=e.O()}]);