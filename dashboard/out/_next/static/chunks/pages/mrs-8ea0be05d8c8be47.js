(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[114],{8174:function(e,t,a){(window.__NEXT_P=window.__NEXT_P||[]).push(["/mrs",function(){return a(1147)}])},4122:function(e,t,a){"use strict";a.d(t,{Z:function(){return Navigation}});var s=a(5893);a(7294);var l=a(1664),n=a.n(l),r=a(1163);function Navigation(){let e=(0,r.useRouter)();return(0,s.jsx)("nav",{className:"bg-blue-600 text-white p-4",children:(0,s.jsxs)("div",{className:"container mx-auto flex justify-between items-center",children:[(0,s.jsx)("div",{className:"flex items-center",children:(0,s.jsx)(n(),{href:"/",children:(0,s.jsx)("span",{className:"text-xl font-bold cursor-pointer",children:"계열사 매출 대시보드"})})}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)(n(),{href:"/",children:(0,s.jsx)("span",{className:"cursor-pointer px-3 py-2 rounded ".concat("/"===e.pathname?"bg-blue-700":"hover:bg-blue-700"),children:"대시보드"})}),(0,s.jsx)(n(),{href:"/admin",children:(0,s.jsx)("span",{className:"cursor-pointer px-3 py-2 rounded ".concat("/admin"===e.pathname?"bg-blue-700":"hover:bg-blue-700"),children:"관리자"})})]})]})})}},3946:function(e,t,a){"use strict";a.d(t,{$7:function(){return getAffiliateConfig},OQ:function(){return l},Qt:function(){return calculateKPIs},fD:function(){return getSalesData}});var s=a(8590);let l=(0,s.eI)("https://ooqexropurnslqmcbjqk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9vcWV4cm9wdXJuc2xxbWNianFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc0NzQyMDUsImV4cCI6MjA2MzA1MDIwNX0.yXVabtxZwX3QFF6xnjmj5VI2Lrp_7fZ3HvS5dCalbuA"),n={ALL:null,MRS:"mrs_sales",WARMGUYS:"warmguys_sales",APGUJEONG:"apgujeong_apgujung_sales",GAROSU:"garosu_sales",GEUKJIN:"geukjin_sales"};async function getSalesData(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:30,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"MRS",a=new Date,s=new Date;if(s.setDate(a.getDate()-e),"ALL"===t){let{data:e,error:t}=await l.from("all_affiliates_view").select("*").gte("date",s.toISOString().split("T")[0]).order("date",{ascending:!0});return t?(console.error("Error fetching all affiliates data:",t),[]):e}{let e=n[t];if(!e)return console.error("Invalid affiliate key:",t),[];let{data:a,error:r}=await l.from(e).select("*").gte("date",s.toISOString().split("T")[0]).order("date",{ascending:!0});return r?(console.error("Error fetching ".concat(e," data:"),r),[]):a}}async function getAffiliateConfig(){let{data:e,error:t}=await l.from("affiliate_config").select("*").eq("is_active",!0).order("affiliate_name");return t?(console.error("Error fetching affiliate config:",t),[]):e}function calculateKPIs(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"MRS";if(!e||0===e.length)return{totalSales:0,averageDailySales:0,totalOrders:0,refundRate:0,growthRate:0};let a=e.reduce((e,t)=>e+(parseFloat(t.total_sales)||0),0),s=a/e.length,l=e.reduce((e,a)=>"APGUJEONG"===t?e+(parseInt(a.customer_count)||0):e+(parseInt(a.order_count)||0),0),n=e.reduce((e,a)=>"GEUKJIN"===t?0:e+(parseFloat(a.refund_amount)||0),0),r=0;if(e.length>=2){let t=e[e.length-1],a=e[e.length-2],s=parseFloat(t.total_sales)||0,l=parseFloat(a.total_sales)||0;l>0&&(r=(s-l)/l*100)}return{totalSales:a,averageDailySales:s,totalOrders:l,refundRate:a>0?n/a*100:0,growthRate:r}}},3850:function(e,t,a){"use strict";function formatNumber(e){return null==e?"0":new Intl.NumberFormat("ko-KR").format(Math.round(e))}function formatPercent(e){return null==e?"0%":"".concat(e.toFixed(1),"%")}a.d(t,{T3:function(){return formatPercent},uf:function(){return formatNumber}})},1147:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return p}});var s=a(5893),l=a(7294),n=a(9008),r=a.n(n),c=a(1163),i=a(3706),o=a(3946),d=a(4122),u=a(3850),h=a(6495),x=a(3148);function SalesTrendChart(e){let{data:t,affiliateKey:a}=e;if(!t||0===t.length)return(0,s.jsx)("div",{className:"flex items-center justify-center h-64 text-gray-500",children:"데이터가 없습니다"});let l={labels:t.map(e=>{let t=new Date(e.date);return"".concat(t.getMonth()+1,"/").concat(t.getDate())}),datasets:[{label:"총 매출",data:t.map(e=>parseFloat(e.total_sales)||0),borderColor:"rgb(59, 130, 246)",backgroundColor:"rgba(59, 130, 246, 0.1)",borderWidth:2,fill:!0,tension:.4}]};return(0,s.jsx)("div",{className:"h-64",children:(0,s.jsx)(h.x1,{data:l,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{display:!1},tooltip:{mode:"index",intersect:!1,callbacks:{label:function(e){let t=e.parsed.y;return"총 매출: ".concat(new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW"}).format(t))}}}},scales:{x:{display:!0,title:{display:!0,text:"날짜"},grid:{display:!1}},y:{display:!0,title:{display:!0,text:"매출 (원)"},ticks:{callback:function(e){return new Intl.NumberFormat("ko-KR",{notation:"compact",compactDisplay:"short"}).format(e)}}}},interaction:{mode:"nearest",axis:"x",intersect:!1},elements:{point:{radius:4,hoverRadius:6}}}})})}function SalesByChannelChart(e){let{data:t}=e;if(!t||0===t.length)return(0,s.jsx)("div",{className:"flex items-center justify-center h-64 text-gray-500",children:"데이터가 없습니다"});let a=["#3B82F6","#10B981","#F59E0B","#EF4444","#8B5CF6","#06B6D4","#84CC16","#F97316"],l={labels:t.map(e=>e.name),datasets:[{data:t.map(e=>e.value),backgroundColor:a.slice(0,t.length),borderColor:a.slice(0,t.length).map(e=>e),borderWidth:2,hoverOffset:4}]};return(0,s.jsx)("div",{className:"h-64",children:(0,s.jsx)(h.$I,{data:l,options:{responsive:!0,maintainAspectRatio:!1,plugins:{legend:{position:"bottom",labels:{padding:20,usePointStyle:!0,pointStyle:"circle"}},tooltip:{callbacks:{label:function(e){let t=e.label||"",a=e.parsed,s=e.dataset.data.reduce((e,t)=>e+t,0),l=(a/s*100).toFixed(1);return"".concat(t,": ").concat(new Intl.NumberFormat("ko-KR",{style:"currency",currency:"KRW"}).format(a)," (").concat(l,"%)")}}}},cutout:"50%"}})})}x.kL.register(x.uw,x.f$,x.od,x.jn,x.Dx,x.u,x.De),x.kL.register(x.qi,x.u,x.De);var components_MRSDashboard=e=>{var t;let{salesData:a,kpis:n}=e,[r,c]=(0,l.useState)({today:{},yesterday:{}}),[i,o]=(0,l.useState)({thisWeek:{},lastWeek:{}}),[d,h]=(0,l.useState)({thisMonth:{},lastMonth:{}});(0,l.useEffect)(()=>{if(!a||0===a.length)return;let e=new Date,t=new Date(e);t.setDate(t.getDate()-1);let formatDate=e=>e.toISOString().split("T")[0],s=a.find(t=>t.date===formatDate(e))||{},l=a.find(e=>e.date===formatDate(t))||{};c({today:s,yesterday:l});let n=new Date(e);n.setDate(e.getDate()-e.getDay());let r=new Date(n);r.setDate(r.getDate()-7);let i=new Date(n);i.setDate(n.getDate()+6);let d=new Date(r);d.setDate(r.getDate()+6);let u=a.filter(e=>{let t=new Date(e.date);return t>=n&&t<=i}),x=a.filter(e=>{let t=new Date(e.date);return t>=r&&t<=d}),p=calculateTotal(u),m=calculateTotal(x);o({thisWeek:p,lastWeek:m});let f=new Date(e.getFullYear(),e.getMonth(),1),g=new Date(e.getFullYear(),e.getMonth()-1,1),j=new Date(e.getFullYear(),e.getMonth(),0),N=a.filter(t=>{let a=new Date(t.date);return a>=f&&a<=e}),y=a.filter(e=>{let t=new Date(e.date);return t>=g&&t<=j}),b=calculateTotal(N),_=calculateTotal(y);h({thisMonth:b,lastMonth:_})},[a]);let calculateTotal=e=>e.reduce((e,t)=>(e.total_sales=(e.total_sales||0)+parseFloat(t.total_sales||0),e.coupang_rocket=(e.coupang_rocket||0)+parseFloat(t.coupang_rocket||0),e.smart_store=(e.smart_store||0)+parseFloat(t.smart_store||0),e.coupang_wing=(e.coupang_wing||0)+parseFloat(t.coupang_wing||0),e.other_online=(e.other_online||0)+parseFloat(t.other_online||0),e.wholesale=(e.wholesale||0)+parseFloat(t.wholesale||0),e.export=(e.export||0)+parseFloat(t.export||0),e.refund_amount=(e.refund_amount||0)+parseFloat(t.refund_amount||0),e),{}),calculateDiff=(e,t,a)=>{let s=parseFloat(e[a]||0),l=parseFloat(t[a]||0);if(0===l)return{value:0,percent:0};let n=s-l;return{value:n,percent:n/l*100}},x=a.length>0?[{name:"쿠팡로켓",value:a.reduce((e,t)=>e+parseFloat(t.coupang_rocket||0),0)},{name:"스마트스토어",value:a.reduce((e,t)=>e+parseFloat(t.smart_store||0),0)},{name:"쿠팡윙",value:a.reduce((e,t)=>e+parseFloat(t.coupang_wing||0),0)},{name:"기타온라인",value:a.reduce((e,t)=>e+parseFloat(t.other_online||0),0)},{name:"도매",value:a.reduce((e,t)=>e+parseFloat(t.wholesale||0),0)},{name:"수출",value:a.reduce((e,t)=>e+parseFloat(t.export||0),0)}].filter(e=>e.value>0):[];return(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"총매출"}),(0,s.jsxs)("p",{className:"text-2xl font-bold",children:[(0,u.uf)(n.totalSales||0),"원"]}),(0,s.jsxs)("p",{className:"text-sm ".concat(n.growthRate>=0?"text-green-500":"text-red-500"),children:[n.growthRate>=0?"↑":"↓"," ",Math.abs(n.growthRate||0).toFixed(1),"%"]})]}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"쿠팡로켓"}),(0,s.jsxs)("p",{className:"text-2xl font-bold",children:[(0,u.uf)(a.reduce((e,t)=>e+parseFloat(t.coupang_rocket||0),0)),"원"]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["전체의 ",(a.reduce((e,t)=>e+parseFloat(t.coupang_rocket||0),0)/n.totalSales*100||0).toFixed(1),"%"]})]}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"스마트스토어"}),(0,s.jsxs)("p",{className:"text-2xl font-bold",children:[(0,u.uf)(a.reduce((e,t)=>e+parseFloat(t.smart_store||0),0)),"원"]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["전체의 ",(a.reduce((e,t)=>e+parseFloat(t.smart_store||0),0)/n.totalSales*100||0).toFixed(1),"%"]})]}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,s.jsx)("h3",{className:"text-sm font-medium text-gray-500",children:"환불액"}),(0,s.jsxs)("p",{className:"text-2xl font-bold text-red-500",children:[(0,u.uf)(a.reduce((e,t)=>e+parseFloat(t.refund_amount||0),0)),"원"]}),(0,s.jsxs)("p",{className:"text-sm text-gray-500",children:["환불률 ",(null===(t=n.refundRate)||void 0===t?void 0:t.toFixed(1))||0,"%"]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-4",children:[(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-3",children:"일별 채널 비교"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"채널"}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"오늘"}),(0,s.jsx)("span",{className:"text-gray-500",children:"어제"}),(0,s.jsx)("span",{className:"text-gray-500",children:"증감"})]})]}),["coupang_rocket","smart_store","coupang_wing","other_online","wholesale","export"].map(e=>{let t=calculateDiff(r.today,r.yesterday,e);return(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:{coupang_rocket:"쿠팡로켓",smart_store:"스마트스토어",coupang_wing:"쿠팡윙",other_online:"기타온라인",wholesale:"도매",export:"수출"}[e]}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)("span",{children:(0,u.uf)(r.today[e]||0)}),(0,s.jsx)("span",{children:(0,u.uf)(r.yesterday[e]||0)}),(0,s.jsxs)("span",{className:t.percent>=0?"text-green-500":"text-red-500",children:[t.percent>=0?"+":"",t.percent.toFixed(1),"%"]})]})]},e)}),(0,s.jsxs)("div",{className:"flex justify-between font-bold mt-2 pt-2 border-t",children:[(0,s.jsx)("span",{children:"총계"}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)("span",{children:(0,u.uf)(r.today.total_sales||0)}),(0,s.jsx)("span",{children:(0,u.uf)(r.yesterday.total_sales||0)}),(0,s.jsxs)("span",{className:calculateDiff(r.today,r.yesterday,"total_sales").percent>=0?"text-green-500":"text-red-500",children:[calculateDiff(r.today,r.yesterday,"total_sales").percent>=0?"+":"",calculateDiff(r.today,r.yesterday,"total_sales").percent.toFixed(1),"%"]})]})]})]})]}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-3",children:"주별 채널 비교"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"채널"}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"이번주"}),(0,s.jsx)("span",{className:"text-gray-500",children:"지난주"}),(0,s.jsx)("span",{className:"text-gray-500",children:"증감"})]})]}),["coupang_rocket","smart_store","coupang_wing","other_online","wholesale","export"].map(e=>{let t=calculateDiff(i.thisWeek,i.lastWeek,e);return(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:{coupang_rocket:"쿠팡로켓",smart_store:"스마트스토어",coupang_wing:"쿠팡윙",other_online:"기타온라인",wholesale:"도매",export:"수출"}[e]}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)("span",{children:(0,u.uf)(i.thisWeek[e]||0)}),(0,s.jsx)("span",{children:(0,u.uf)(i.lastWeek[e]||0)}),(0,s.jsxs)("span",{className:t.percent>=0?"text-green-500":"text-red-500",children:[t.percent>=0?"+":"",t.percent.toFixed(1),"%"]})]})]},e)}),(0,s.jsxs)("div",{className:"flex justify-between font-bold mt-2 pt-2 border-t",children:[(0,s.jsx)("span",{children:"총계"}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)("span",{children:(0,u.uf)(i.thisWeek.total_sales||0)}),(0,s.jsx)("span",{children:(0,u.uf)(i.lastWeek.total_sales||0)}),(0,s.jsxs)("span",{className:calculateDiff(i.thisWeek,i.lastWeek,"total_sales").percent>=0?"text-green-500":"text-red-500",children:[calculateDiff(i.thisWeek,i.lastWeek,"total_sales").percent>=0?"+":"",calculateDiff(i.thisWeek,i.lastWeek,"total_sales").percent.toFixed(1),"%"]})]})]})]})]}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-3",children:"월별 채널 비교"}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"채널"}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)("span",{className:"text-gray-500",children:"이번달"}),(0,s.jsx)("span",{className:"text-gray-500",children:"지난달"}),(0,s.jsx)("span",{className:"text-gray-500",children:"증감"})]})]}),["coupang_rocket","smart_store","coupang_wing","other_online","wholesale","export"].map(e=>{let t=calculateDiff(d.thisMonth,d.lastMonth,e);return(0,s.jsxs)("div",{className:"flex justify-between",children:[(0,s.jsx)("span",{children:{coupang_rocket:"쿠팡로켓",smart_store:"스마트스토어",coupang_wing:"쿠팡윙",other_online:"기타온라인",wholesale:"도매",export:"수출"}[e]}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)("span",{children:(0,u.uf)(d.thisMonth[e]||0)}),(0,s.jsx)("span",{children:(0,u.uf)(d.lastMonth[e]||0)}),(0,s.jsxs)("span",{className:t.percent>=0?"text-green-500":"text-red-500",children:[t.percent>=0?"+":"",t.percent.toFixed(1),"%"]})]})]},e)}),(0,s.jsxs)("div",{className:"flex justify-between font-bold mt-2 pt-2 border-t",children:[(0,s.jsx)("span",{children:"총계"}),(0,s.jsxs)("div",{className:"flex space-x-4",children:[(0,s.jsx)("span",{children:(0,u.uf)(d.thisMonth.total_sales||0)}),(0,s.jsx)("span",{children:(0,u.uf)(d.lastMonth.total_sales||0)}),(0,s.jsxs)("span",{className:calculateDiff(d.thisMonth,d.lastMonth,"total_sales").percent>=0?"text-green-500":"text-red-500",children:[calculateDiff(d.thisMonth,d.lastMonth,"total_sales").percent>=0?"+":"",calculateDiff(d.thisMonth,d.lastMonth,"total_sales").percent.toFixed(1),"%"]})]})]})]})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-3",children:"채널별 매출 추이"}),(0,s.jsx)(SalesTrendChart,{salesData:a})]}),(0,s.jsxs)("div",{className:"bg-white p-4 rounded-lg shadow",children:[(0,s.jsx)("h3",{className:"text-lg font-medium mb-3",children:"채널별 비율"}),(0,s.jsx)("div",{className:"h-64",children:(0,s.jsx)(SalesByChannelChart,{channelData:x})})]})]})]})},p=(0,i.QO)(function(){let[e,t]=(0,l.useState)(!0),[a,n]=(0,l.useState)([]),[i,u]=(0,l.useState)({}),[h,x]=(0,l.useState)(30);(0,c.useRouter)(),(0,l.useEffect)(()=>{(async function(){t(!0);try{let e=await (0,o.fD)(h,"MRS");n(e);let t=(0,o.Qt)(e,"MRS");u(t)}catch(e){console.error("Error fetching MRS data:",e)}finally{t(!1)}})()},[h]);let handlePeriodChange=e=>{x(e)};return(0,s.jsxs)("div",{className:"min-h-screen bg-gray-100",children:[(0,s.jsxs)(r(),{children:[(0,s.jsx)("title",{children:"웜가이즈 - MRS 대시보드"}),(0,s.jsx)("meta",{name:"description",content:"웜가이즈 MRS 매출 대시보드"})]}),(0,s.jsx)(d.Z,{}),(0,s.jsxs)("main",{className:"container mx-auto px-4 py-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold mb-6",children:"MRS 대시보드"}),(0,s.jsx)("div",{className:"flex justify-end mb-4",children:(0,s.jsxs)("div",{className:"flex space-x-2",children:[(0,s.jsx)("button",{onClick:()=>handlePeriodChange(7),className:"px-4 py-2 rounded ".concat(7===h?"bg-blue-500 text-white":"bg-gray-200"),children:"7일"}),(0,s.jsx)("button",{onClick:()=>handlePeriodChange(30),className:"px-4 py-2 rounded ".concat(30===h?"bg-blue-500 text-white":"bg-gray-200"),children:"30일"}),(0,s.jsx)("button",{onClick:()=>handlePeriodChange(90),className:"px-4 py-2 rounded ".concat(90===h?"bg-blue-500 text-white":"bg-gray-200"),children:"90일"})]})}),e?(0,s.jsx)("div",{className:"flex justify-center items-center h-64",children:(0,s.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500"})}):(0,s.jsx)(components_MRSDashboard,{salesData:a,kpis:i})]})]})})}},function(e){e.O(0,[196,227,664,421,774,888,179],function(){return e(e.s=8174)}),_N_E=e.O()}]);