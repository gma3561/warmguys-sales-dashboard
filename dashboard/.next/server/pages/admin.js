"use strict";(()=>{var e={};e.id=964,e.ids=[964,888,660],e.modules={6337:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.d(t,{Ct:()=>i.Z,Dx:()=>f.Z,RM:()=>l.Z,SC:()=>u.Z,Zb:()=>n.Z,iA:()=>c.Z,pj:()=>o.Z,ss:()=>d.Z,xs:()=>x.Z,zx:()=>a.Z});var i=s(2754),a=s(6896),n=s(4940),c=s(8978),l=s(7184),o=s(3749),d=s(3384),x=s(1675),u=s(4234),p=s(7641),f=s(9970),h=e([i,a,n,c,l,o,d,x,u,p,f]);[i,a,n,c,l,o,d,x,u,p,f]=h.then?(await h)():h,r()}catch(e){r(e)}})},5007:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{config:()=>j,default:()=>u,getServerSideProps:()=>h,getStaticPaths:()=>f,getStaticProps:()=>p,reportWebVitals:()=>m,routeModule:()=>v,unstable_getServerProps:()=>y,unstable_getServerSideProps:()=>S,unstable_getStaticParams:()=>b,unstable_getStaticPaths:()=>g,unstable_getStaticProps:()=>_});var i=s(7093),a=s(5244),n=s(1323),c=s(9209),l=s.n(c),o=s(1065),d=s(925),x=e([d]);d=(x.then?(await x)():x)[0];let u=(0,n.l)(d,"default"),p=(0,n.l)(d,"getStaticProps"),f=(0,n.l)(d,"getStaticPaths"),h=(0,n.l)(d,"getServerSideProps"),j=(0,n.l)(d,"config"),m=(0,n.l)(d,"reportWebVitals"),_=(0,n.l)(d,"unstable_getStaticProps"),g=(0,n.l)(d,"unstable_getStaticPaths"),b=(0,n.l)(d,"unstable_getStaticParams"),y=(0,n.l)(d,"unstable_getServerProps"),S=(0,n.l)(d,"unstable_getServerSideProps"),v=new i.PagesRouteModule({definition:{kind:a.x.PAGES,page:"/admin",pathname:"/admin",bundlePath:"",filename:""},components:{App:o.default,Document:l()},userland:d});r()}catch(e){r(e)}})},925:(e,t,s)=>{s.a(e,async(e,r)=>{try{s.r(t),s.d(t,{default:()=>Admin});var i=s(997),a=s(6689),n=s(968),c=s.n(n),l=s(3946),o=s(6337),d=e([o]);function Admin(){let[e,t]=(0,a.useState)([]),[s,r]=(0,a.useState)(!0),[n,d]=(0,a.useState)({});(0,a.useEffect)(()=>{(async function(){r(!0);let e=await (0,l.$7)();t(e),r(!1)})()},[]);let initiateSync=async e=>{d(t=>({...t,[e]:"pending"}));try{let t=await fetch("https://ooqexropurnslqmcbjqk.functions.supabase.co/data-sync",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9vcWV4cm9wdXJuc2xxbWNianFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc0NzQyMDUsImV4cCI6MjA2MzA1MDIwNX0.yXVabtxZwX3QFF6xnjmj5VI2Lrp_7fZ3HvS5dCalbuA"},body:JSON.stringify({affiliate_key:e})}),s=await t.json();s.success?d(t=>({...t,[e]:"success"})):d(t=>({...t,[e]:"error"}))}catch(t){console.error("동기화 요청 에러:",t),d(t=>({...t,[e]:"error"}))}setTimeout(()=>{d(t=>{let s={...t};return delete s[e],s})},5e3)},toggleAffiliateActive=async(e,s)=>{try{let{error:r}=await l.OQ.from("affiliate_config").update({is_active:!s}).eq("affiliate_key",e);if(r)throw r;t(t=>t.map(t=>t.affiliate_key===e?{...t,is_active:!s}:t))}catch(e){console.error("계열사 상태 변경 에러:",e)}},getBadgeColor=e=>{switch(e){case"success":return"green";case"pending":return"yellow";case"error":return"red";default:return"gray"}};return(0,i.jsxs)("div",{children:[(0,i.jsxs)(c(),{children:[i.jsx("title",{children:"관리자 - 계열사 매출 대시보드"}),i.jsx("meta",{name:"description",content:"계열사 매출 데이터 관리"}),i.jsx("link",{rel:"icon",href:"/favicon.ico"})]}),(0,i.jsxs)("main",{className:"p-6",children:[(0,i.jsxs)("div",{className:"mb-6",children:[i.jsx("h1",{className:"text-2xl font-bold",children:"계열사 관리"}),i.jsx("p",{className:"text-gray-500",children:"데이터 동기화 및 계열사 설정"})]}),s?i.jsx("div",{className:"flex justify-center items-center h-64",children:i.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500"})}):(0,i.jsxs)(o.Zb,{children:[i.jsx(o.Dx,{children:"계열사 설정"}),(0,i.jsxs)(o.iA,{className:"mt-4",children:[i.jsx(o.ss,{children:(0,i.jsxs)(o.SC,{children:[i.jsx(o.xs,{children:"계열사 ID"}),i.jsx(o.xs,{children:"계열사명"}),i.jsx(o.xs,{children:"스프레드시트"}),i.jsx(o.xs,{children:"마지막 동기화"}),i.jsx(o.xs,{children:"상태"}),i.jsx(o.xs,{children:"동기화"}),i.jsx(o.xs,{children:"활성화"})]})}),i.jsx(o.RM,{children:e.map(e=>(0,i.jsxs)(o.SC,{children:[i.jsx(o.pj,{children:e.affiliate_key}),i.jsx(o.pj,{children:e.affiliate_name}),i.jsx(o.pj,{children:i.jsx("a",{href:`https://docs.google.com/spreadsheets/d/${e.spreadsheet_id}`,target:"_blank",rel:"noopener noreferrer",className:"text-blue-500 hover:underline",children:e.sheet_name})}),i.jsx(o.pj,{children:e.last_successful_sync?new Date(e.last_successful_sync).toLocaleString("ko-KR"):"없음"}),i.jsx(o.pj,{children:n[e.affiliate_key]?i.jsx(o.Ct,{color:getBadgeColor(n[e.affiliate_key]),children:"success"===n[e.affiliate_key]?"성공":"pending"===n[e.affiliate_key]?"진행 중":"오류"}):i.jsx(o.Ct,{color:e.sync_enabled?"green":"gray",children:e.sync_enabled?"동기화 활성화":"동기화 비활성화"})}),i.jsx(o.pj,{children:i.jsx(o.zx,{size:"xs",color:"blue",onClick:()=>initiateSync(e.affiliate_key),disabled:"pending"===n[e.affiliate_key]||!e.sync_enabled,children:"지금 동기화"})}),i.jsx(o.pj,{children:i.jsx(o.zx,{size:"xs",color:e.is_active?"green":"red",onClick:()=>toggleAffiliateActive(e.affiliate_key,e.is_active),children:e.is_active?"활성화됨":"비활성화됨"})})]},e.id))})]})]})]})]})}o=(d.then?(await d)():d)[0],r()}catch(e){r(e)}})},2885:e=>{e.exports=require("@supabase/supabase-js")},6924:e=>{e.exports=require("date-fns/endOfMonth")},3864:e=>{e.exports=require("date-fns/endOfWeek")},4384:e=>{e.exports=require("date-fns/format")},5564:e=>{e.exports=require("date-fns/locale")},5914:e=>{e.exports=require("date-fns/startOfMonth")},2659:e=>{e.exports=require("date-fns/startOfWeek")},5358:e=>{e.exports=require("date-fns/subDays")},2785:e=>{e.exports=require("next/dist/compiled/next-server/pages.runtime.prod.js")},968:e=>{e.exports=require("next/head")},6689:e=>{e.exports=require("react")},6405:e=>{e.exports=require("react-dom")},997:e=>{e.exports=require("react/jsx-runtime")},1964:e=>{e.exports=import("@floating-ui/react")},510:e=>{e.exports=import("react-transition-state")},8097:e=>{e.exports=import("tailwind-merge")},1395:e=>{e.exports=import("tslib")},7147:e=>{e.exports=require("fs")},1017:e=>{e.exports=require("path")},2781:e=>{e.exports=require("stream")},9796:e=>{e.exports=require("zlib")}};var t=require("../webpack-runtime.js");t.C(e);var __webpack_exec__=e=>t(t.s=e),s=t.X(0,[761,163,209,450,832,65,946],()=>__webpack_exec__(5007));module.exports=s})();