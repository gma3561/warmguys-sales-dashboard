"use strict";exports.id=946,exports.ids=[946],exports.modules={3946:(e,t,a)=>{a.d(t,{$7:()=>getAffiliateConfig,OQ:()=>l,Qt:()=>calculateKPIs,fD:()=>getSalesData});var r=a(2885);let l=(0,r.createClient)("https://ooqexropurnslqmcbjqk.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9vcWV4cm9wdXJuc2xxbWNianFrIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc0NzQyMDUsImV4cCI6MjA2MzA1MDIwNX0.yXVabtxZwX3QFF6xnjmj5VI2Lrp_7fZ3HvS5dCalbuA"),s={ALL:null,MRS:"mrs_sales",WARMGUYS:"warmguys_sales",APGUJEONG:"apgujeong_sales",GEUKJIN:"geukjin_sales"};async function getSalesData(e=30,t="MRS"){let a=new Date,r=new Date;if(r.setDate(a.getDate()-e),"ALL"===t){let{data:e,error:t}=await l.from("all_affiliates_view").select("*").gte("date",r.toISOString().split("T")[0]).order("date",{ascending:!0});return t?(console.error("Error fetching all affiliates data:",t),[]):e}{let e=s[t];if(!e)return console.error("Invalid affiliate key:",t),[];let{data:a,error:i}=await l.from(e).select("*").gte("date",r.toISOString().split("T")[0]).order("date",{ascending:!0});return i?(console.error(`Error fetching ${e} data:`,i),[]):a}}async function getAffiliateConfig(){let{data:e,error:t}=await l.from("affiliate_config").select("*").eq("is_active",!0).order("affiliate_name");return t?(console.error("Error fetching affiliate config:",t),[]):e}function calculateKPIs(e,t="MRS"){if(!e||0===e.length)return{totalSales:0,averageDailySales:0,totalOrders:0,refundRate:0,growthRate:0};let a=e.reduce((e,t)=>e+(parseFloat(t.total_sales)||0),0),r=a/e.length,l=e.reduce((e,a)=>"APGUJEONG"===t?e+(parseInt(a.customer_count)||0):e+(parseInt(a.order_count)||0),0),s=e.reduce((e,a)=>"GEUKJIN"===t?0:e+(parseFloat(a.refund_amount)||0),0),i=0;if(e.length>=2){let t=e[e.length-1],a=e[e.length-2],r=parseFloat(t.total_sales)||0,l=parseFloat(a.total_sales)||0;l>0&&(i=(r-l)/l*100)}return{totalSales:a,averageDailySales:r,totalOrders:l,refundRate:a>0?s/a*100:0,growthRate:i}}}};